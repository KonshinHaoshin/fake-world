# 用户切换功能测试指南

## 🧪 测试准备

1. 确保开发服务器已启动：`pnpm run dev`
2. 在浏览器中打开应用
3. 导航到设置页面：点击"我" → "设置"

## 📋 测试步骤

### 测试1：添加新用户
1. 在设置页面中，点击"添加新用户"按钮
2. 在弹出的对话框中填写：
   - 昵称：`测试用户1`
   - 微信号：`testuser1`
   - 头像URL：`https://via.placeholder.com/100x100?text=测试头像`
3. 点击"添加"按钮
4. **预期结果**：新用户应该出现在"其他用户"列表中

### 测试2：用户切换
1. 在"其他用户"列表中找到刚创建的"测试用户1"
2. 点击该用户行
3. 在弹出的确认对话框中点击"确定"
4. **预期结果**：
   - 页面应该重新渲染
   - 顶部应该显示"测试用户1"的信息
   - 其他用户列表应该更新

### 测试3：验证用户切换
1. 切换用户后，点击左上角的返回按钮回到"我"页面
2. **预期结果**：
   - 头像应该显示为"测试用户1"的头像
   - 昵称应该显示为"测试用户1"
   - 微信号应该显示为"testuser1"

### 测试4：再次切换用户
1. 再次进入设置页面
2. 在"其他用户"列表中找到默认用户（通常是第一个用户）
3. 点击切换回默认用户
4. **预期结果**：
   - 页面应该重新渲染
   - 应该显示默认用户的信息

### 测试5：退出登录
1. 在设置页面的当前用户信息区域，点击"退出"按钮
2. 在确认对话框中点击"确定"
3. **预期结果**：
   - 应该回到默认用户账号
   - 页面应该显示默认用户的信息

## 🔍 问题排查

### 如果用户切换不生效：
1. 检查浏览器控制台是否有错误信息
2. 确认 `activeUserIdAtom` 是否正确更新
3. 检查 `activeUserProfileAtom` 是否正确获取数据

### 如果页面不重新渲染：
1. 确认 `refreshKey` 状态是否正确更新
2. 检查组件是否正确使用了 `activeUserProfileAtom`
3. 确认 Jotai 状态管理是否正常工作

### 如果数据不持久化：
1. 检查 localStorage 中是否正确存储了 `activeUserId`
2. 确认 `atomWithStorage` 是否正常工作

## 📊 测试检查清单

- [ ] 能够成功添加新用户
- [ ] 用户切换后页面正确重新渲染
- [ ] 切换后的用户信息正确显示
- [ ] 返回"我"页面后显示正确的用户信息
- [ ] 能够切换回默认用户
- [ ] 退出登录功能正常工作
- [ ] 用户数据正确持久化存储

## 🐛 已知问题

1. **页面刷新**：当前实现会在用户切换后重新渲染页面，这是正常行为
2. **数据同步**：所有相关页面都会自动更新为当前活跃用户的信息
3. **状态管理**：使用 Jotai 确保状态的一致性和响应性

## 🎯 成功标准

当所有测试步骤都通过，并且：
- 用户可以在不同账号之间自由切换
- 切换后的用户信息在所有页面都正确显示
- 用户数据正确持久化存储
- 没有控制台错误

则认为用户切换功能实现成功！

## 📝 测试报告模板

```
测试日期：_________
测试人员：_________
测试环境：_________

测试结果：
□ 通过
□ 部分通过
□ 失败

问题描述：
_________________________________
_________________________________

建议改进：
_________________________________
_________________________________
``` 